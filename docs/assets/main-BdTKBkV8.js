import{P as H,S as ve}from"./StudioScene-DCgEznM_.js";const v="/gensoftworks/",_={emre:{name:"Emre Kaya",role:"Worldbuilder",room:"Zimmer 12a",gender:"‚ôÇ",flag:"üáπüá∑üá©üá™"},vera:{name:"Vera Morozova",role:"Concept Artist",room:"Zimmer 12b",gender:"‚ôÄ",flag:"üáµüá±üá©üá™"},tobi:{name:"Tobias Richter",role:"Tech Lead",room:"Zimmer 12c",gender:"‚ôÇ",flag:"üá©üá™"},darius:{name:"Darius Varga",role:"Game Director",room:"Zimmer 12d",gender:"‚ôÇ",flag:"üá©üá™"},nami:{name:"Nami Osei",role:"Narrative Designer",room:"Schreibstube (12e)",gender:"‚ôÄ",flag:"üá≥üá¨üá©üá™"},leo:{name:"Leo Ferretti",role:"Community Manager",room:"Zimmer 12f",gender:"‚ôÄ",flag:"üá©üá™üáÆüá∑"},finn:{name:"Finn Calloway",role:"Producer",room:"Zimmer 12 (CD-B√ºro)",gender:"‚ôÇ",flag:"üá©üá™"}};let u=null,p=0,f=0;function Y(n){if(typeof n=="number")return n;const s=String(n).match(/^(\d+)-supplement$/);return s?parseInt(s[1])+.5:parseFloat(n)||999}function M(n){return!!n?.is_supplement}const S=document.getElementById("sim-select"),x=document.getElementById("day-select"),$=document.getElementById("scene-select"),V=document.getElementById("scene-badge"),oe=document.getElementById("scene-time"),le=document.getElementById("scene-location"),ie=document.getElementById("scene-participants"),ce=document.getElementById("scene-summary"),N=document.getElementById("key-moment"),B=document.getElementById("artifact-list"),F=document.getElementById("day-summary"),j=document.getElementById("agent-list"),G=document.getElementById("btn-prev"),R=document.getElementById("btn-next");async function he(){let n=null;try{const l=await fetch(`${v}data/index.json`);l.ok&&(n=await l.json())}catch{}if(n&&n.simulations.length>0){for(const r of n.simulations){const d=document.createElement("option");d.value=r.file,d.textContent=r.label,r.id===n.default&&(d.selected=!0),S.appendChild(d)}S.style.display=n.simulations.length>1?"":"none",S.addEventListener("change",()=>O(S.value));const l=n.simulations.find(r=>r.id===n.default)||n.simulations[0];await O(l.file)}else S.style.display="none",await O("simulation.json");x.addEventListener("change",()=>{p=parseInt(x.value),f=0,q(),k()}),$.addEventListener("change",()=>{f=parseInt($.value),k()}),G.addEventListener("click",()=>ee(-1)),R.addEventListener("click",()=>ee(1)),window.addEventListener("viewer:agent-click",l=>{_e(l.detail.agentKey)});const s=document.getElementById("agent-profile-overlay");document.getElementById("profile-close").addEventListener("click",()=>{s.classList.remove("open")}),s.addEventListener("click",l=>{l.target===s&&s.classList.remove("open")});const e=document.getElementById("document-overlay"),t=()=>{e.classList.remove("open"),E=null};document.getElementById("doc-modal-close").addEventListener("click",t),e.addEventListener("click",l=>{l.target===e&&t()}),document.getElementById("doc-ver-prev").addEventListener("click",()=>D(-1)),document.getElementById("doc-ver-next").addEventListener("click",()=>D(1)),document.addEventListener("keydown",l=>{!e.classList.contains("open")&&!o.classList.contains("open")||(e.classList.contains("open")&&(l.key==="ArrowLeft"&&(l.preventDefault(),D(-1)),l.key==="ArrowRight"&&(l.preventDefault(),D(1)),l.key==="Escape"&&(l.preventDefault(),t())),o.classList.contains("open")&&l.key==="Escape"&&(l.preventDefault(),a()),i.classList.contains("open")&&l.key==="Escape"&&(l.preventDefault(),i.classList.remove("open")))});const o=document.getElementById("gallery-overlay"),i=document.getElementById("gallery-lightbox"),a=()=>o.classList.remove("open");document.getElementById("btn-gallery").addEventListener("click",we),document.getElementById("gallery-close").addEventListener("click",a),o.addEventListener("click",l=>{l.target===o&&a()}),i.addEventListener("click",()=>i.classList.remove("open"))}async function O(n){u=await(await fetch(`${v}data/${n}`)).json(),window.__simData=u,p=0,f=0,x.innerHTML="";for(let e=0;e<u.days.length;e++){const t=document.createElement("option");t.value=e;const o=u.days[e];if(M(o)){const i=o.summary?.weekday||"Supplement";t.textContent=`‚ú® ${i}`}else t.textContent=`Tag ${o.day}`;x.appendChild(t)}q(),k(),K(),window.dispatchEvent(new CustomEvent("viewer:data-ready"))}function ee(n){const s=u.days[p],e=s.scenes.length||(M(s)?1:0),t=f+n;if(t>=0&&t<e)f=t,$.value=f,k();else if(n>0&&p<u.days.length-1)p++,f=0,x.value=p,q(),k();else if(n<0&&p>0){p--,x.value=p,q();const o=u.days[p];f=M(o)?0:Math.max(0,o.scenes.length-1),$.value=f,k()}}function q(){$.innerHTML="";const n=u.days[p];if(M(n)){const s=document.createElement("option");s.value=0,s.textContent=n.summary?.phase||"Supplement",$.appendChild(s),f=0,$.value=0;return}for(let s=0;s<n.scenes.length;s++){const e=n.scenes[s],t=document.createElement("option");t.value=s,t.textContent=`${e.type_label} ‚Äî ${e.time_label}`,$.appendChild(t)}$.value=f}function k(){const n=u.days[p];if(M(n)){be(n);return}const s=re();if(!s)return;const e=p===0&&f===0,t=p===u.days.length-1&&f===u.days[p].scenes.length-1;G.disabled=e,R.disabled=t,V.textContent=s.type_label,V.className=`badge ${s.type.replace(/\+/g,"_")}`,oe.textContent=s.time_label,le.textContent=s.location_label;const o=s.participants.map(i=>_[i]?.name||i);ie.innerHTML=o.map(i=>`<span>${i}</span>`).join(", "),ce.textContent=s.summary,s.key_moment?(N.textContent=s.key_moment,N.style.display="block"):N.style.display="none",de(),$e(s.artifacts||[]),Be(s),K(),window.dispatchEvent(new CustomEvent("viewer:scene-change",{detail:{dayIndex:p,sceneIndex:f}}))}function be(n){const s=n.supplement||{},e=n.summary||{},t=p===0,o=p===u.days.length-1;G.disabled=t,R.disabled=o,V.textContent="Supplement",V.className="badge SUPPLEMENT",oe.textContent=e.weekday||"",le.textContent="",ie.innerHTML="<span>Vera Morozova</span> (Opus-Modell)",ce.textContent=e.summary||e.title||"",N.style.display="none",de();const i=s.phases||[];let a="";for(const d of i)a+='<div class="artifact-note-block" style="margin-bottom:8px">',a+=`<strong>Phase ${d.phase}: ${d.title}</strong>`,a+=`<div style="margin-top:4px;opacity:0.85">${d.description}</div>`,d.images_generated&&(a+=`<div style="margin-top:4px;font-size:11px;opacity:0.7">${d.images_generated} Bilder ¬∑ ${d.cost}</div>`),a+="</div>";const l=s.budget_total;l&&(a+='<div class="artifact-note-block" style="margin-top:12px">',a+="<strong>Budget gesamt</strong>",a+='<div style="margin-top:4px;font-size:12px">',a+=`Simulation: ${l.simulation_total}<br>`,a+=`Nachholen: ${l.supplement_day5_catchup}<br>`,a+=`Supplement: ${l.supplement_new}<br>`,a+=`<strong>Gesamt: ${l.grand_total}</strong>`,a+="</div></div>");const r=s.context;if(r?.model_comparison){const d=r.model_comparison;a+='<div class="artifact-note-block" style="margin-top:12px">',a+="<strong>Modellvergleich</strong>",a+='<div style="margin-top:4px;font-size:12px">',a+=`Simulation (${d.simulation_model}): ${d.simulation_images} Bilder ¬∑ ${d.simulation_budget_used}<br>`,a+=`Supplement (${d.supplement_model}): ${d.supplement_images} Bilder ¬∑ ${d.supplement_budget_used}`,a+="</div></div>"}B.innerHTML=a,j.innerHTML="",K()}function re(){return u&&u.days[p]?.scenes[f]||null}function de(){const n=u.days[p],s=n?.summary;if(!s){F.style.display="none";return}let e="";if(e+='<div class="day-summary-header" id="day-summary-toggle">',e+='<span class="arrow">&#9654;</span>',e+='<span class="day-summary-icon">&#128203;</span>',e+=`ZUSAMMENFASSUNG ‚Äî Tag ${s.day||n.day}`,e+="</div>",e+='<div class="day-summary-body" id="day-summary-body">',s.phase&&(e+=`<span class="day-summary-phase">${s.phase}</span> `),e+=`<div class="day-summary-title">${s.title||""}</div>`,e+=`<div class="day-summary-text">${s.summary||""}</div>`,s.cd_decisions?.length){e+='<div class="day-summary-decisions">',e+='<div class="day-summary-decisions-label">CD-Entscheidungen</div>';for(const t of s.cd_decisions)e+=`<div class="day-summary-decision">${t}</div>`;e+="</div>"}if(s.key_moments?.length){e+='<div class="day-summary-moments">';for(const t of s.key_moments)e+=`<div class="day-summary-moment">${t}</div>`;e+="</div>"}e+="</div>",F.innerHTML=e,F.style.display="block",document.getElementById("day-summary-toggle").addEventListener("click",()=>{const t=document.getElementById("day-summary-body"),o=document.querySelector("#day-summary-toggle .arrow");t.classList.toggle("open"),o.classList.toggle("open")})}function $e(n){const s=re();if(!n||n.length===0){B.style.display="none";return}const e=s?.note_contents||{},t=c=>/\/00-.+\.md$/i.test(c),o=c=>/\.(png|jpg|jpeg|gif|webp)$/i.test(c),i=n.filter(c=>!c.startsWith("pinwall/"));if(i.length===0){B.style.display="none";return}B.style.display="block";let a='<div class="artifacts-title">ARTEFAKTE</div>';const l=i.filter(t),r=i.filter(c=>o(c)),d=i.filter(c=>!t(c)&&!o(c));for(let c=0;c<l.length;c++){const m=l[c],g=m.split("/").pop(),h=Ee(g),I=`artifact-note-${c}`,w=e[m];a+='<div class="artifact-note">',a+=`<button class="artifact-note-toggle" data-target="${I}">`,a+=`<span class="arrow">&#9654;</span> ${h}`,a+="</button>",w?a+=`<div class="artifact-note-body" id="${I}">${J(w)}</div>`:a+=`<div class="artifact-note-body" id="${I}"><span class="loading">Kein Inhalt verf√ºgbar.</span></div>`,a+="</div>"}if(r.length>0){a+='<div class="artifact-thumbs">';for(const c of r){const m=c.split("/").pop(),g=m.replace(/[_][^.]+/,"").replace(/\.[^.]+$/,"");a+=`<div class="artifact-thumb" data-path="${c}" title="${m}">`,a+=`<img src="${v}${c}" alt="${g}" loading="lazy">`,a+=`<span class="artifact-thumb-label">${g}</span>`,a+="</div>"}a+="</div>"}for(const c of d){const m=c.split("/").pop();a+='<div class="artifact-item">',a+='<span class="artifact-icon">[doc]</span>',a+=`<span class="artifact-name" title="${c}">${m}</span>`,a+="</div>"}B.innerHTML=a,B.querySelectorAll(".artifact-note-toggle").forEach(c=>{c.addEventListener("click",()=>{const m=document.getElementById(c.dataset.target),g=c.querySelector(".arrow");m.classList.contains("open")?(m.classList.remove("open"),g.classList.remove("open")):(m.classList.add("open"),g.classList.add("open"))})}),B.querySelectorAll(".artifact-thumb").forEach(c=>{c.addEventListener("click",()=>{const m=c.dataset.path,g=u?.concept_art?.find(I=>I.path===m)||{},h=document.getElementById("gallery-lightbox");document.getElementById("gallery-lightbox-img").src=`${v}${m}`,document.getElementById("gallery-lightbox-model").textContent=g.model||"",document.getElementById("gallery-lightbox-prompt").textContent=g.prompt||"",h.classList.add("open")})})}function Ee(n){const e=n.replace(/^00-/,"").replace(/-v\d+\.md$/,"").replace(/\.md$/,"").split("-"),t=e.pop(),o=e.map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join("-"),i=t.charAt(0).toUpperCase()+t.slice(1);return`${o}: ${i}`}const Le=[{key:"transcript.md",label:"Transcript"}];function te(n,s){let e='<div class="trace-block">';e+='<div class="trace-block-label">TRACES</div>';for(const t of Le){const o=`${n}-${t.key.replace(".","-")}`,i=`${v}${s}${t.key}`;e+=`<button class="trace-toggle" data-target="${o}" data-url="${i}">`,e+=`<span class="arrow">&#9654;</span> ${t.label}`,e+="</button>",e+=`<div class="trace-body" id="${o}"><span class="loading">Laden...</span></div>`}return e+="</div>",e}function Ie(n,s){const e=`${n}-transcript`;let t='<div class="trace-block">';return t+=`<button class="trace-toggle" data-target="${e}" data-url="${v}${s}">`,t+='<span class="arrow">&#9654;</span> Transkript',t+="</button>",t+=`<div class="trace-body" id="${e}"><span class="loading">Laden...</span></div>`,t+="</div>",t}function Be(n){const s=n.participants;let e="";if(Array.isArray(n.transcript_list)&&n.transcript_list.length>0)for(let t=0;t<n.transcript_list.length;t++){const o=n.transcript_list[t],i=`tl-${t}`,a=o.agent==="_gm",l=_[o.agent];a?(e+='<div class="transcript-gm">',e+=`<button class="trace-toggle gm-toggle" data-target="${i}" data-url="${v}${o.url}">`,e+=`<span class="arrow">&#9654;</span> ${o.label}`,e+="</button>",e+=`<div class="trace-body" id="${i}"><span class="loading">Laden...</span></div>`,e+="</div>"):(e+='<div class="transcript-entry">',e+=`<button class="trace-toggle" data-target="${i}" data-url="${v}${o.url}">`,e+='<span class="arrow">&#9654;</span>',e+=`<span class="transcript-agent">${l?.name||o.agent}</span>`,o.order!=null&&(e+=`<span class="transcript-turn">#${o.order}</span>`),l&&(e+=`<span class="transcript-role">${l.role}</span>`),e+="</button>",e+=`<div class="trace-body" id="${i}"><span class="loading">Laden...</span></div>`,e+="</div>")}else{const t=s.filter(a=>_[a]),o=!!n.transcripts,i=n.mood&&typeof n.mood=="object"&&!Array.isArray(n.mood);n.traces?._shared&&(e+=te("trace-shared",n.traces._shared));for(const a of t){const l=_[a];if(e+=`<div class="agent-card" id="agent-card-${a}">`,e+='<div class="agent-card-header">',e+=`<span class="agent-name">${l.name}</span>`,e+=`<span class="agent-role">${l.role}</span>`,e+="</div>",o)n.transcripts?.[a]&&(e+=Ie(`transcript-${a}`,n.transcripts[a]));else if(i){const r=n.mood?.[a];r&&(e+='<div class="mood-row">',e+='<span class="mood-label">Stimmung:</span> ',e+=`<span class="mood-value">${r.before||"‚Äî"}</span> `,e+='<span class="mood-arrow">&rarr;</span> ',e+=`<span class="mood-value">${r.after||"‚Äî"}</span>`,e+="</div>");const d=(n.dialogue||[]).filter(m=>m.who===a);if(d.length){e+='<div class="dialogue-section">';for(const m of d)e+=`<div class="dialogue-line">"${m.says}"</div>`;e+="</div>"}const c=(n.thoughts||[]).filter(m=>m.who===a);if(c.length)for(const m of c)e+=`<div class="agent-thought">${m.thinks}</div>`}else{const r=n.agent_details?.[a],d=n.memories?.[a];if(r&&(e+='<div class="mood-row">',e+='<span class="mood-label">Stimmung:</span> ',e+=`<span class="mood-value">${r.mood_before||"‚Äî"}</span> `,e+='<span class="mood-arrow">&rarr;</span> ',e+=`<span class="mood-value">${r.mood_after||"‚Äî"}</span>`,e+="</div>",r.key_reaction&&(e+=`<div class="agent-reaction">${r.key_reaction}</div>`)),d?.length){e+='<div class="memories-title">Erinnerungen</div>';for(const c of d)e+='<div class="memory-item">',e+=`<span class="mem-type">${c.type}</span>`,e+=`<span class="mem-importance">${c.importance}/10</span>`,e+=c.description,e+="</div>"}}n.traces?.[a]&&(e+=te(`trace-${a}`,n.traces[a])),e+="</div>"}}j.innerHTML=e,j.querySelectorAll(".trace-toggle").forEach(t=>{t.addEventListener("click",async()=>{const o=document.getElementById(t.dataset.target),i=t.querySelector(".arrow");if(o.classList.contains("open")){o.classList.remove("open"),i.classList.remove("open");return}if(i.classList.add("open"),o.dataset.loaded!=="true"){try{const a=await fetch(t.dataset.url);if(a.ok){const l=await a.text();o.innerHTML=J(l)}else o.innerHTML='<span class="loading">Nicht gefunden.</span>'}catch{o.innerHTML='<span class="loading">Fehler beim Laden.</span>'}o.dataset.loaded="true"}o.classList.add("open")})})}const z=new Audio(`${v}audio/paper-turn.mp3`);z.preload="auto";z.volume=.7;function U(){z.currentTime=0,z.play().catch(()=>{})}let E=null;function Z(n){if(!n)return!1;const s=u.days[p]?.day||1,e=u.days[p]?.scenes[f]?.scene||1,t=Y(n.day),o=Y(s);return t<o||t===o&&(n.scene||0)<=e}function me(n){return Z(n.first_appeared)}function ue(n){if(!me(n))return[];const s=n.versions.filter(e=>Z(e.appeared));return s.length>0?s:n.versions}function K(){const n=document.getElementById("document-bar-content"),s=u?.chapters;if(!s||!s.gdd?.length&&!s.wbb?.length){n.innerHTML="";return}let e="";for(const a of["gdd","wbb"]){const l=s[a];if(!l?.length)continue;const r=l.filter(me);if(r.length){e+='<div class="doc-group">',e+=`<span class="doc-group-label">${a.toUpperCase()}</span>`;for(const d of r){const c=ue(d),m=c[c.length-1],g=Math.min(c.length+1,4);e+=`<div class="doc-stack" data-doc-type="${a}" data-chapter-id="${d.id}" title="${d.title}">`,e+='<div class="doc-pages">';for(let h=0;h<g;h++)e+=`<div class="doc-page" style="left:${h*2}px;bottom:${h}px;"></div>`;e+="</div>",e+=`<div class="doc-label">${d.id.slice(0,2)} v${m.version}</div>`,e+="</div>"}e+="</div>"}}n.innerHTML=e,n.querySelectorAll(".doc-stack").forEach(a=>{a.addEventListener("click",()=>{ke(a.dataset.docType,a.dataset.chapterId)})});const t=ge().length,o=document.getElementById("btn-gallery"),i=document.getElementById("gallery-count");o&&o.classList.toggle("has-art",t>0),i&&(i.textContent=t>0?t:"")}function ke(n,s){const e=u?.chapters?.[n];if(!e)return;const t=e.find(i=>i.id===s);if(!t)return;const o=ue(t);o.length&&(U(),document.getElementById("doc-modal-badge").textContent=n.toUpperCase(),document.getElementById("doc-modal-badge").className=`badge doc-modal-badge ${n}`,document.getElementById("doc-modal-title").textContent=t.title,E={docType:n,chapter:t,versions:o,versionIdx:o.length-1},pe(),document.getElementById("document-overlay").classList.add("open"))}function pe(){if(!E)return;const{versions:n,versionIdx:s}=E,e=n[s],t=n.length,o=document.getElementById("doc-modal-content"),i=document.getElementById("doc-modal-nav"),a=document.getElementById("doc-modal-version"),l=document.getElementById("doc-ver-prev"),r=document.getElementById("doc-ver-next"),d=document.getElementById("doc-ver-label");o.innerHTML=J(e.content),a.textContent=`V${e.version}`,t>1?(i.style.display="flex",d.textContent=`V${e.version} von ${n[t-1].version}`,l.disabled=s===0,r.disabled=s===t-1):i.style.display="none",document.getElementById("document-modal").scrollTop=0}function D(n){if(!E)return;const s=E.versionIdx+n;s<0||s>=E.versions.length||(E.versionIdx=s,U(),pe())}function ge(){const n=u?.concept_art;return n?.length?n.filter(s=>Z(s.appeared)):[]}function xe(){const n=ge(),s=document.getElementById("gallery-grid"),e=document.getElementById("gallery-empty");if(document.getElementById("btn-gallery").classList.toggle("has-art",n.length>0),!n.length){e.style.display="block",s.innerHTML="";return}e.style.display="none";const o=n.length<=4?260:n.length<=12?180:130;s.style.setProperty("--gallery-thumb",`${o}px`);let i="";for(const a of n)i+=`<div class="gallery-card" data-path="${a.path}">`,i+=`<img src="${v}${a.path}" alt="${a.filename}" loading="lazy">`,i+='<div class="gallery-card-label">',i+=`<span class="gallery-card-category">${a.category}</span> ${a.filename}`,i+="</div></div>";s.innerHTML=i,s.querySelectorAll(".gallery-card").forEach(a=>{a.addEventListener("click",()=>{const l=a.dataset.path,r=u.concept_art?.find(c=>c.path===l)||{},d=document.getElementById("gallery-lightbox");document.getElementById("gallery-lightbox-img").src=`${v}${l}`,document.getElementById("gallery-lightbox-model").textContent=r.model||"",document.getElementById("gallery-lightbox-prompt").textContent=r.prompt||"",d.classList.add("open")})})}function we(){U(),xe(),document.getElementById("gallery-overlay").classList.add("open")}function J(n){const s=n.split(`
`);let e="",t=!1,o="ul",i=!1;for(const a of s){const l=a.trim();if(!l){t&&(e+=`</${o}>`,t=!1),i&&(e+="</blockquote>",i=!1);continue}if(/^[-*_]{3,}$/.test(l)){t&&(e+=`</${o}>`,t=!1),e+="<hr>";continue}if(l.startsWith("### ")){t&&(e+=`</${o}>`,t=!1),e+=`<h3>${b(l.slice(4))}</h3>`;continue}if(l.startsWith("## ")){t&&(e+=`</${o}>`,t=!1),e+=`<h2>${b(l.slice(3))}</h2>`;continue}if(l.startsWith("# ")){t&&(e+=`</${o}>`,t=!1),e+=`<h1>${b(l.slice(2))}</h1>`;continue}if(l.startsWith("> ")){t&&(e+=`</${o}>`,t=!1),i||(e+="<blockquote>",i=!0),e+=`<p>${b(l.slice(2))}</p>`;continue}if(i&&(e+="</blockquote>",i=!1),l.startsWith("- ")||l.startsWith("* ")){t&&o!=="ul"&&(e+=`</${o}>`,t=!1),t||(e+="<ul>",t=!0,o="ul"),e+=`<li>${b(l.slice(2))}</li>`;continue}const r=l.match(/^(\d+)\.\s+(.+)/);if(r){t&&o!=="ol"&&(e+=`</${o}>`,t=!1),t||(e+="<ol>",t=!0,o="ol"),e+=`<li>${b(r[2])}</li>`;continue}t&&(e+=`</${o}>`,t=!1),e+=`<p>${b(l)}</p>`}return t&&(e+=`</${o}>`),i&&(e+="</blockquote>"),e}function Se(n){const s=n.split(`
`);let e="",t=!1;for(const o of s){const i=o.trim();if(!i){t&&(e+="</ul>",t=!1);continue}if(i.startsWith("- ")){t||(e+='<ul style="margin:2px 0 2px 14px;padding:0;list-style:disc;">',t=!0),e+=`<li>${b(i.slice(2))}</li>`;continue}t&&(e+="</ul>",t=!1),e+=`<p>${b(i)}</p>`}return t&&(e+="</ul>"),e}function b(n){return n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/_(.+?)_/g,"<em>$1</em>")}function _e(n){const s=_[n];if(!s)return;document.getElementById("profile-name").textContent=s.name,document.getElementById("profile-role").textContent=s.role,document.getElementById("profile-room").textContent=s.room,document.getElementById("profile-icons").textContent=`${s.gender} ${s.flag}`;const e=document.getElementById("profile-memory");let t="";const o=u?.agent_memories?.[n]||[],i=u.days[p]?.day||1,a=u.days[p]?.scenes[f]?.scene||1,l=o.filter(c=>c.day<i||c.day===i&&c.scene<=a);if(t+='<button class="section-toggle" data-target="mem-list">',t+=`<span class="arrow open">‚ñ∂</span> Erinnerungen (${l.length})`,t+="</button>",t+='<div class="section-body" id="mem-list">',l.length===0)t+='<div class="memory-empty">Noch keine Erinnerungen bis zu dieser Szene.</div>';else for(const c of l.slice().reverse())t+='<div class="memory-entry">',t+=`<div class="memory-entry-header">Tag ${c.day}, Szene ${c.scene} (${c.type})</div>`,t+=`<div>${c.text}</div>`,t+="</div>";t+="</div>";const r=u?.roster?.[n];if(t+='<button class="section-toggle" data-target="bio-list">',t+='<span class="arrow">‚ñ∂</span> Steckbrief',t+="</button>",t+='<div class="section-body" id="bio-list" style="display: none;">',r){r.color&&(t+=`<div class="bio-row"><span class="profile-color-dot" style="background:${r.color}"></span><span class="bio-value">${r.name}</span></div>`);const c=[["Alter",r.age],["Pronouns",r.pronouns],["Arbeitsplatz",r.workspace],["Hintergrund",r.background],["Adresse",r.address],["Arbeitsweg",r.commute]];for(const[m,g]of c)g&&(t+=`<div class="bio-row"><span class="bio-label">${m}:</span><span class="bio-value">${g}</span></div>`)}else t+='<div class="memory-empty">Kein Profil verf√ºgbar.</div>';if(t+="</div>",r?.sections){const c={Identit√§t:"‚ú¶","Herkunft & Bildung":"üéì",Pers√∂nlichkeit:"‚ô•",Lieblingsspiele:"üéÆ",Privatleben:"üè†","D&D":"üé≤",Arbeitsstil:"‚è∞",Werkzeuge:"üõ†",Schl√ºsselbeziehungen:"ü§ù"};let m=0;for(const[g,h]of Object.entries(r.sections)){const I=c[g]||"‚óã",w=`profile-sec-${m++}`;t+=`<button class="section-toggle" data-target="${w}">`,t+=`<span class="arrow">‚ñ∂</span> ${I} ${g}`,t+="</button>",t+=`<div class="section-body" id="${w}" style="display: none;">`,t+=`<div class="profile-section-content">${Se(h)}</div>`,t+="</div>"}}e.innerHTML=t,e.querySelectorAll(".section-toggle").forEach(c=>{c.addEventListener("click",()=>{const m=document.getElementById(c.dataset.target),g=c.querySelector(".arrow");m.style.display==="none"?(m.style.display="block",g.classList.add("open")):(m.style.display="none",g.classList.remove("open"))})}),document.getElementById("agent-profile-overlay").classList.add("open");const d=document.getElementById(`agent-card-${n}`);d&&d.scrollIntoView({behavior:"smooth",block:"nearest"})}const ne="/gensoftworks/";let y=null,P=[],C=null,L=!1,T=!1,A=.15;const se=600;function Q(){return 2e3+Math.random()*6e3}function Ce(n,s,e){n.volume=0,n.play().catch(()=>{});const t=20,o=s/t,i=e/t;let a=0;const l=setInterval(()=>{a++,n.volume=Math.min(o*a,s),a>=t&&clearInterval(l)},i)}function Me(n,s){const e=n.volume,t=20,o=e/t,i=s/t;let a=0;const l=setInterval(()=>{a++,n.volume=Math.max(e-o*a,0),a>=t&&(clearInterval(l),n.pause())},i)}function X(){if(L||!T||P.length===0)return;const n=P[Math.floor(Math.random()*P.length)],s=n.cloneNode(),t=Math.random()<.2?5+Math.random()*2:2.5+Math.random()*1.5,o=Math.min(A*t,1);Ce(s,o,se);const i=n.duration||8;setTimeout(()=>Me(s,se),Math.max((i-.8)*1e3,1e3)),C=setTimeout(X,Q())}function fe(){if(!T){T=!0,y=new Audio(`${ne}audio/lofi-ambient.mp3`),y.loop=!0,y.volume=A,y.play().catch(()=>{});for(let n=1;n<=3;n++){const s=new Audio(`${ne}audio/typing-0${n}.mp3`);s.preload="auto",P.push(s)}C=setTimeout(X,Q()),ye()}}function ye(){const n=document.getElementById("btn-audio-toggle");n&&(L?(n.classList.remove("active"),n.textContent="‚ô´"):(n.classList.add("active"),n.textContent="‚ô™"))}function W(){L=!L,L?(y&&y.pause(),C&&clearTimeout(C)):(T||fe(),y&&(y.volume=A,y.play().catch(()=>{})),C=setTimeout(X,Q())),ye()}function Te(n){A=n,y&&(y.volume=A)}function Ae(){const n=document.getElementById("btn-audio-toggle"),s=document.getElementById("audio-volume");n&&n.addEventListener("click",W),s&&s.addEventListener("input",()=>{const t=parseInt(s.value)/100;Te(t),t===0&&!L&&W(),t>0&&L&&W()});const e=()=>{!T&&!L&&fe(),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};document.addEventListener("click",e),document.addEventListener("keydown",e)}const ae=document.getElementById("game-container"),De={type:H.AUTO,parent:"game-container",width:ae.clientWidth,height:ae.clientHeight,backgroundColor:"#131317",scale:{mode:H.Scale.RESIZE,autoCenter:H.Scale.CENTER_BOTH},scene:[ve],pixelArt:!0,roundPixels:!0};window.__phaserGame=new H.Game(De);he();Ae();
