% GenSoftworks Logbook — extra header for Pandoc default template
% Included via --include-in-header

% Heading font
\newfontfamily\headingfont{SourceSerif4}[
  Path = ../assets/fonts/,
  UprightFont = {SourceSerif4-Variable.ttf},
  ItalicFont = {SourceSerif4-Italic-Variable.ttf},
  BoldFont = {SourceSerif4-Variable.ttf},
  BoldItalicFont = {SourceSerif4-Italic-Variable.ttf},
  BoldFeatures = {Weight=700},
  BoldItalicFeatures = {Weight=700}
]

% Colors
\definecolor{thoughttint}{HTML}{EDE8F0}
\definecolor{reflecttint}{HTML}{E8F0ED}
\definecolor{artifacttint}{HTML}{F0EDE8}
\definecolor{scenelabel}{HTML}{666666}
\definecolor{border}{HTML}{DDDDDD}
\definecolor{lightgray}{HTML}{BBBBBB}

% Agent sprite icons
\newcommand{\agenticon}[1]{%
  \raisebox{-4pt}{\includegraphics[height=16pt]{icons/#1.png}}\,%
}

% Bubble type icons
\newcommand{\thoughtbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-thought.png}}\,%
}
\newcommand{\speechbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-speech.png}}\,%
}
\newcommand{\planbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-plan.png}}\,%
}
\newcommand{\reflectionbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-reflection.png}}\,%
}
\newcommand{\artifactbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-artifact.png}}\,%
}
\newcommand{\feedbackbubble}{%
  \raisebox{-3pt}{\includegraphics[height=12pt]{icons/bubble-speech.png}}\,%
}

% Importance stars (v2)
\newcommand{\stmark}[1]{★#1}

% Tables: word-wrap in cells, small font
\usepackage{etoolbox}
\renewcommand{\arraystretch}{1.3}
\AtBeginEnvironment{longtable}{\small}

% Header
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\small\color{gray}\thepage}
\fancyhead[R]{\small\color{lightgray}\itshape GenSoftworks Logbuch}

% Heading styles
\usepackage{titlesec}
\setcounter{secnumdepth}{0}

\titleformat{\section}
  {\headingfont\fontsize{20pt}{24pt}\selectfont\itshape}
  {}{0em}{}
\titlespacing*{\section}{0pt}{6mm}{3mm}

\newcommand{\sectionbreak}{\clearpage}

\titleformat{\subsection}
  {\headingfont\fontsize{13pt}{16pt}\selectfont\itshape}
  {}{0em}{}
\titlespacing*{\subsection}{0pt}{0.5mm}{0.3mm}

\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries}
  {}{0em}{}
\titlespacing*{\subsubsection}{0pt}{0.5mm}{0.2mm}

% Two-column traces
\usepackage{multicol}

% URL line-breaking (xurl allows breaks at any character)
\usepackage{xurl}

% Wrap figures (screenshot left, text right)
\usepackage{wrapfig}

% Breakable monospace text (for file paths in traces)
\newcommand{\breaktt}[1]{%
  {\ttfamily\sloppy\emergencystretch=3em\hfuzz=1em #1}%
}

% Body text one size smaller globally
\AtBeginDocument{\small}

% Prevent LaTeX from stretching vertical space to fill pages
\raggedbottom

% Scene boxes
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

\newenvironment{scenemeta}{%
  \vspace{0.5mm}{\small\color{scenelabel}\sffamily%
}{%
  \par}\vspace{1mm}%
}

\newtcolorbox{thought}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{thoughttint!80!black},
  colback=thoughttint!30,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=3mm, after skip=3mm, breakable,
  fontupper=\itshape\small}

\newtcolorbox{reflection}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{reflecttint!80!black},
  colback=reflecttint!30,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=3mm, after skip=3mm, breakable,
  fontupper=\itshape\small}

\newtcolorbox{artifact}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{artifacttint!80!black},
  colback=artifacttint!30,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=3mm, after skip=3mm, breakable,
  fontupper=\small}

% Feedback box (v2 — agent-to-agent feedback)
\definecolor{feedbacktint}{HTML}{E8EDF0}

\newtcolorbox{feedbackbox}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{feedbacktint!80!black},
  colback=feedbacktint!30,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=3mm, after skip=3mm, breakable,
  fontupper=\small}

% Creative Director directive — distinct dark box
\newtcolorbox{directive}{enhanced, frame hidden,
  borderline west={3pt}{0pt}{black!70},
  colback=black!8,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=4mm, after skip=4mm, breakable,
  fontupper=\small\sffamily}

% Agent detail box (emotional arcs per agent)
\definecolor{agentdetailtint}{HTML}{F0F0E8}

\newtcolorbox{agentdetail}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{agentdetailtint!80!black},
  colback=agentdetailtint!30,
  left=6mm, right=6mm, top=3mm, bottom=3mm,
  before skip=3mm, after skip=3mm, breakable,
  fontupper=\small}

% Narrative transcript box (screenplay-format dialogue)
\definecolor{transcripttint}{HTML}{F5F5F5}

\newtcolorbox{transcript}{enhanced, frame hidden,
  borderline west={2pt}{0pt}{transcripttint!60!black},
  colback=transcripttint!50,
  left=6mm, right=6mm, top=4mm, bottom=4mm,
  before skip=4mm, after skip=4mm, breakable,
  fontupper=\small\ttfamily}

\newcommand{\scenedivider}{%
  \vspace{2mm}%
  \noindent\makebox[\linewidth]{\color{border}\rule{0.3\linewidth}{0.4pt}}%
  \vspace{2mm}%
}
